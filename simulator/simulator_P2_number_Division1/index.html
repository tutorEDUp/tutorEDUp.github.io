<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é™¤æ³•(ä¸€) Division (I) - Interactive Simulator</title>
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5', // Indigo 600
                        secondary: '#10B981', // Emerald 500
                        accent: '#F59E0B', // Amber 500
                        surface: '#F3F4F6', // Gray 100
                    },
                    fontFamily: {
                        sans: ['Noto Sans TC', 'Helvetica', 'Arial', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }

        .apple-anim { transition: all 0.5s ease-in-out; }

        /* Long Division Grid */
        .division-grid {
            display: grid;
            grid-template-columns: repeat(5, 1.5rem);
            grid-template-rows: repeat(7, 2.5rem);
            gap: 2px;
            font-family: 'Courier New', monospace;
            font-size: 1.75rem;
            font-weight: bold;
            text-align: center;
            align-items: center;
            justify-content: center;
        }

        .v-line-sub { border-bottom: 2px solid white; margin-top: -2px; }
        .v-step-active { color: #F59E0B; transform: scale(1.1); transition: all 0.3s; }
        .v-hidden { opacity: 0; pointer-events: none; }
        .v-visible { opacity: 1; transition: opacity 0.5s ease-in; }
        
        /* Highlight for digits */
        .digit-highlight { color: #F59E0B; transition: color 0.3s; }

        /* Step List Styling */
        .step-item {
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }
        .step-item.active {
            background-color: #EEF2FF;
            border-left-color: #4F46E5;
            transform: translateX(4px);
            color: #312E81;
            font-weight: 700;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-white shadow-sm z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center gap-4">
                    <img src="logo.png" alt="Logo" class="h-10 w-auto object-contain" onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNEY0NkU1IiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PHBhdGggZD0iTTEyIDJMMiA3bDEwIDUgMTAtNS0xMC01ek0yIDE3bDEwIDUgMTAtNU0yIDEybDEwIDUgMTAtNSIvPjwvc3ZnPg=='">
                    <h1 class="text-xl font-bold text-gray-900 hidden sm:block" id="app-title">é™¤æ³•(ä¸€) Division (I)</h1>
                </div>
                <nav class="hidden md:flex space-x-2" id="nav-desktop"></nav>
                <div class="flex items-center gap-2">
                    <button id="lang-toggle" class="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium border border-gray-300 transition-colors">EN</button>
                    <button id="mobile-menu-btn" class="md:hidden p-2 rounded-md text-gray-600 hover:text-gray-900 hover:bg-gray-100"><i data-lucide="menu"></i></button>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-gray-200">
            <div class="px-2 pt-2 pb-3 space-y-1" id="nav-mobile"></div>
        </div>
    </header>

    <!-- Main -->
    <main id="main-content" class="flex-1 overflow-y-auto p-4 sm:p-6 lg:p-8 bg-surface relative"></main>

    <script>
        // --- DATA & STATE ---
        const state = {
            lang: 'zh',
            currentTab: 'vertical',
            concepts: {
                sharing: { total: 12, groups: 3 },
                grouping: { total: 12, perGroup: 4 }
            }
        };

        const i18n = {
            zh: {
                appTitle: "é™¤æ³•(ä¸€)",
                tabs: { sharing: "ç­‰åˆ†æ¦‚å¿µ", grouping: "åŒ…å«æ¦‚å¿µ", notation: "èªè­˜ç®—å¼", vertical: "è±Žå¼æ­¥é©Ÿ", practice: "è‡ªæˆ‘æŒ‘æˆ°" },
                sharing: {
                    title: "é™¤æ³•æ¦‚å¿µ (ä¸€)ï¼šç­‰åˆ† (Sharing)",
                    desc: "å°‡ç‰©å“å¹³å‡åˆ†çµ¦å¹¾å€‹äººæˆ–å¹¾çµ„ã€‚",
                    instruction: "æˆ‘å€‘æœ‰ {t} å€‹è˜‹æžœï¼Œå¹³å‡åˆ†çµ¦ {g} å€‹ç›¤å­ã€‚",
                    btnDistribute: "é–‹å§‹åˆ†ç™¼",
                    btnReset: "é‡ç½®"
                },
                grouping: {
                    title: "é™¤æ³•æ¦‚å¿µ (äºŒ)ï¼šåŒ…å« (Grouping)",
                    desc: "æ¯å¹¾å€‹ç‰©å“è£ä¸€çµ„ï¼Œçœ‹çœ‹èƒ½è£å¹¾çµ„ã€‚",
                    instruction: "æˆ‘å€‘æœ‰ {t} é¡†æ˜Ÿæ˜Ÿï¼Œæ¯ {g} é¡†è£æˆä¸€è¢‹ã€‚",
                    btnGroup: "é–‹å§‹åˆ†çµ„",
                    btnReset: "é‡ç½®"
                },
                notation: {
                    title: "èªè­˜ç®—å¼èˆ‡è¡“èªž",
                    desc: "é»žæ“Šç®—å¼çš„ä¸åŒéƒ¨åˆ†ä¾†äº†è§£åç¨±ã€‚",
                    horizontal: "æ©«å¼",
                    vertical: "è±Žå¼ (é•·é™¤æ³•)",
                    dividend: "è¢«é™¤æ•¸ (Dividend)",
                    dividendDesc: "è¦è¢«åˆ†æŽ‰çš„ç¸½æ•¸ã€‚",
                    divisor: "é™¤æ•¸ (Divisor)",
                    divisorDesc: "è¦åˆ†æˆçš„çµ„æ•¸ï¼Œæˆ–æ˜¯æ¯çµ„çš„æ•¸é‡ã€‚",
                    quotient: "å•† (Quotient)",
                    quotientDesc: "åˆ†å®Œå¾Œï¼Œæ¯çµ„çš„æ•¸é‡æˆ–æ˜¯çµ„æ•¸ (ç­”æ¡ˆ)ã€‚",
                    remainder: "é¤˜æ•¸ (Remainder)",
                    remainderDesc: "åˆ†å®Œå¾Œå‰©ä¸‹ï¼Œä¸å¤ å†åˆ†çš„æ•¸é‡ã€‚"
                },
                verticalStep: {
                    title: "è±Žå¼è¨ˆç®—æ¼”ç¤º",
                    problem: "é¡Œç›®ï¼š75 Ã· 3",
                    step0: "æº–å‚™é–‹å§‹ï¼šå¯«å¥½é™¤æ•¸ 3 å’Œè¢«é™¤æ•¸ 75ã€‚",
                    step1: "1. çœ‹åä½ï¼šè¢«é™¤æ•¸çš„åä½æ˜¯ 7ã€‚7 è£¡é¢æœ‰å¹¾å€‹ 3ï¼Ÿ",
                    step2: "2. ä¸Šå•†ï¼š3 x 2 = 6ï¼Œåœ¨åä½å¯«ä¸Š 2ã€‚",
                    step3: "3. ç›¸ä¹˜ï¼šå°‡ 3 x 2 çš„ç© 6 å¯«åœ¨ 7 ä¸‹é¢ã€‚",
                    step4: "4. ç›¸æ¸›ï¼š7 - 6 = 1ï¼Œç•«æ©«ç·šä¸¦å¯«ä¸‹ 1ã€‚",
                    step5: "5. è½ä¸‹ï¼šå°‡å€‹ä½çš„ 5 ç§»ä¸‹ä¾†ï¼Œçµ„æˆ 15ã€‚",
                    step6: "6. çœ‹å€‹ä½ï¼šç¾åœ¨è¨ˆç®— 15 Ã· 3ã€‚15 è£¡é¢æœ‰å¹¾å€‹ 3ï¼Ÿ",
                    step7: "7. ä¸Šå•†ï¼š3 x 5 = 15ï¼Œåœ¨å€‹ä½å¯«ä¸Š 5ã€‚",
                    step8: "8. å†ä¹˜ï¼šå°‡ 3 x 5 çš„ç© 15 å¯«åœ¨ä¸‹é¢ã€‚",
                    step9: "9. æ¸›ç›¡ï¼š15 - 15 = 0ï¼Œç•«æ©«ç·šä¸¦å¯«ä¸‹ 0ã€‚",
                    step10: "å®Œæˆï¼å•†æ˜¯ 25ï¼Œé¤˜æ•¸æ˜¯ 0ã€‚",
                    btnNext: "ä¸‹ä¸€æ­¥",
                    btnRestart: "é‡æ–°é–‹å§‹"
                },
                practice: {
                    title: "è‡ªæˆ‘æŒ‘æˆ°",
                    question: "è«‹å•ï¼š",
                    check: "æª¢æŸ¥ç­”æ¡ˆ",
                    next: "ä¸‹ä¸€é¡Œ",
                    correct: "å¤ªæ£’äº†ï¼ ðŸŽ‰",
                    wrong: "å†è©¦ä¸€æ¬¡ï¼ ðŸ’ª",
                    score: "å¾—åˆ†ï¼š"
                }
            },
            en: {
                appTitle: "Division (I)",
                tabs: { sharing: "Sharing", grouping: "Grouping", notation: "Notation", vertical: "Long Division", practice: "Practice" },
                sharing: {
                    title: "Sharing Concept",
                    desc: "Distribute items equally.",
                    instruction: "We have {t} apples for {g} plates.",
                    btnDistribute: "Start",
                    btnReset: "Reset"
                },
                grouping: {
                    title: "Grouping Concept",
                    desc: "Put items into groups of a size.",
                    instruction: "We have {t} stars, {g} per bag.",
                    btnGroup: "Start",
                    btnReset: "Reset"
                },
                notation: {
                    title: "Notation",
                    desc: "Click parts to learn names.",
                    horizontal: "Equation",
                    vertical: "Long Division",
                    dividend: "Dividend",
                    dividendDesc: "Total amount.",
                    divisor: "Divisor",
                    divisorDesc: "Number of groups.",
                    quotient: "Quotient",
                    quotientDesc: "Answer.",
                    remainder: "Remainder",
                    remainderDesc: "Left over."
                },
                verticalStep: {
                    title: "Long Division Steps",
                    problem: "Problem: 75 Ã· 3",
                    step0: "Ready: 3 and 75.",
                    step1: "1. Tens: How many 3s in 7?",
                    step2: "2. Quotient: 3 x 2 = 6. Write 2 on top.",
                    step3: "3. Multiply: Write 6.",
                    step4: "4. Subtract: Write 1.",
                    step5: "5. Bring down: Bring 5 down to make 15.",
                    step6: "6. Ones: How many 3s in 15?",
                    step7: "7. Quotient: Write 5.",
                    step8: "8. Multiply: Write 15.",
                    step9: "9. Subtract: Write 0.",
                    step10: "Done! Quotient 25, Remainder 0.",
                    btnNext: "Next",
                    btnRestart: "Restart"
                },
                practice: {
                    title: "Practice",
                    question: "Solve:",
                    check: "Check",
                    next: "Next",
                    correct: "Correct! ðŸŽ‰",
                    wrong: "Try again! ðŸ’ª",
                    score: "Score:"
                }
            }
        };

        const tabs = [
            { id: 'concept_sharing', icon: 'share-2' },
            { id: 'concept_grouping', icon: 'package' },
            { id: 'notation', icon: 'file-digit' },
            { id: 'vertical', icon: 'arrow-down-narrow-wide' },
            { id: 'practice', icon: 'pencil' }
        ];

        // --- GLOBAL DOM REFS ---
        let mainContent, navDesktop, navMobile, mobileMenu, appTitle;

        let currentVStep = 0;
        let sharingInterval = null;
        let groupingTimeout = null;
        let currentQ = {};
        let pScore = 0;

        function init() {
            mainContent = document.getElementById('main-content');
            navDesktop = document.getElementById('nav-desktop');
            navMobile = document.getElementById('nav-mobile');
            mobileMenu = document.getElementById('mobile-menu');
            appTitle = document.getElementById('app-title');

            renderNav();
            renderContent();
            lucide.createIcons();
            document.getElementById('lang-toggle').addEventListener('click', toggleLang);
            document.getElementById('mobile-menu-btn').addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
        }

        function toggleLang() {
            state.lang = state.lang === 'zh' ? 'en' : 'zh';
            document.getElementById('lang-toggle').innerText = state.lang === 'zh' ? 'EN' : 'ä¸­æ–‡';
            renderNav();
            renderContent();
        }

        function switchTab(tabId) {
            state.currentTab = tabId;
            mobileMenu.classList.add('hidden');
            renderNav();
            renderContent();
        }

        function getText(path) {
            const keys = path.split('.');
            let obj = i18n[state.lang];
            for (let k of keys) { if(obj) obj = obj[k]; }
            return obj || path;
        }

        function renderNav() {
            appTitle.innerText = getText('appTitle');
            const navHtml = tabs.map(tab => `
                <button onclick="switchTab('${tab.id}')" class="${state.currentTab === tab.id ? 'bg-primary text-white' : 'text-gray-600 hover:bg-gray-100'} px-3 py-2 rounded-md text-sm font-medium transition-colors flex items-center gap-2">
                    <i data-lucide="${tab.icon}" width="16" height="16"></i> ${getText(`tabs.${tab.id.split('_').pop()}`)}
                </button>
            `).join('');
            navDesktop.innerHTML = navHtml;
            navMobile.innerHTML = navHtml;
            lucide.createIcons();
        }

        function clearTimers() {
            if (sharingInterval) clearInterval(sharingInterval);
            if (groupingTimeout) clearTimeout(groupingTimeout);
        }

        function renderContent() {
            clearTimers();
            mainContent.innerHTML = '';
            const container = document.createElement('div');
            container.className = "max-w-4xl mx-auto bg-white rounded-2xl shadow-lg p-6 sm:p-8 min-h-[70vh]";
            mainContent.appendChild(container);

            switch(state.currentTab) {
                case 'concept_sharing': renderSharing(container); break;
                case 'concept_grouping': renderGrouping(container); break;
                case 'notation': renderNotation(container); break;
                case 'vertical': renderVertical(container); break;
                case 'practice': renderPractice(container); break;
            }
            lucide.createIcons();
        }

        // --- SHARING ---
        function renderSharing(container) {
            const t = getText('sharing');
            container.innerHTML = `
                <h2 class="text-2xl font-bold text-primary mb-2">${t.title}</h2>
                <p class="text-gray-600 mb-6">${t.desc}</p>
                <div class="bg-blue-50 p-6 rounded-xl border border-blue-100 mb-6 text-center">
                    <p class="text-lg mb-4">${t.instruction.replace('{t}', state.concepts.sharing.total).replace('{g}', state.concepts.sharing.groups)}</p>
                    <div class="flex justify-center gap-4">
                        <button onclick="runSharingAnim()" class="bg-primary text-white px-6 py-2 rounded-full font-bold shadow-md hover:bg-indigo-700 transition">${t.btnDistribute}</button>
                        <button onclick="resetSharing()" class="bg-white text-gray-600 border px-6 py-2 rounded-full hover:bg-gray-50 transition">${t.btnReset}</button>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 min-h-[250px]">
                    <div id="sharing-source" class="bg-gray-50 border-2 border-dashed rounded-xl p-4 flex flex-wrap gap-2 justify-center content-start"></div>
                    <div id="sharing-dest" class="grid grid-cols-3 gap-4"></div>
                </div>
            `;
            resetSharing();
        }

        function resetSharing() {
            const source = document.getElementById('sharing-source');
            const dest = document.getElementById('sharing-dest');
            if(!source || !dest) return;
            source.innerHTML = ''; dest.innerHTML = '';
            for(let i=0; i<state.concepts.sharing.total; i++) {
                source.innerHTML += `<div id="apple-${i}" class="w-10 h-10 bg-red-500 rounded-full flex items-center justify-center text-white shadow"><i data-lucide="apple" width="20"></i></div>`;
            }
            for(let i=0; i<state.concepts.sharing.groups; i++) {
                dest.innerHTML += `<div id="plate-${i}" class="w-24 h-24 bg-white border-2 border-blue-200 rounded-full flex flex-wrap p-2 justify-center items-center gap-1 shadow-inner"></div>`;
            }
            lucide.createIcons();
        }

        function runSharingAnim() {
            resetSharing();
            let count = 0;
            sharingInterval = setInterval(() => {
                if(count >= state.concepts.sharing.total) { clearInterval(sharingInterval); return; }
                const apple = document.getElementById(`apple-${count}`);
                const plate = document.getElementById(`plate-${count % state.concepts.sharing.groups}`);
                if(apple && plate) plate.appendChild(apple);
                count++;
            }, 300);
        }

        // --- GROUPING ---
        function renderGrouping(container) {
            const t = getText('grouping');
            container.innerHTML = `
                <h2 class="text-2xl font-bold text-secondary mb-2">${t.title}</h2>
                <p class="text-gray-600 mb-6">${t.desc}</p>
                <div class="bg-green-50 p-6 rounded-xl border border-green-100 mb-6 text-center">
                    <p class="text-lg mb-4">${t.instruction.replace('{t}', state.concepts.grouping.total).replace('{g}', state.concepts.grouping.perGroup)}</p>
                    <div class="flex justify-center gap-4">
                        <button onclick="runGroupingAnim()" class="bg-secondary text-white px-6 py-2 rounded-full font-bold shadow-md hover:bg-emerald-600 transition">${t.btnGroup}</button>
                        <button onclick="resetGrouping()" class="bg-white text-gray-600 border px-6 py-2 rounded-full hover:bg-gray-50 transition">${t.btnReset}</button>
                    </div>
                </div>
                <div id="grouping-area" class="bg-white border rounded-xl p-8 flex flex-wrap gap-4 justify-center items-center min-h-[250px]"></div>
            `;
            resetGrouping();
        }

        function resetGrouping() {
            const area = document.getElementById('grouping-area');
            if(!area) return;
            area.innerHTML = '';
            for(let i=0; i<state.concepts.grouping.total; i++) {
                area.innerHTML += `<div class="text-yellow-500"><i data-lucide="star" fill="currentColor"></i></div>`;
            }
            lucide.createIcons();
        }

        function runGroupingAnim() {
            const area = document.getElementById('grouping-area');
            if(!area) return;
            const stars = Array.from(area.children);
            area.innerHTML = '';
            const per = state.concepts.grouping.perGroup;
            for(let i=0; i<stars.length; i+=per) {
                const bag = document.createElement('div');
                bag.className = "border-2 border-emerald-500 bg-emerald-50 rounded-lg p-2 flex gap-1 w-24 flex-wrap justify-center transform scale-0 animate-[bounce_0.5s_forwards]";
                for(let j=0; j<per; j++) { if(stars[i+j]) bag.appendChild(stars[i+j].cloneNode(true)); }
                area.appendChild(bag);
            }
        }

        // --- NOTATION ---
        function renderNotation(container) {
            const t = getText('notation');
            container.innerHTML = `
                <h2 class="text-2xl font-bold text-indigo-900 mb-6">${t.title}</h2>
                <div class="grid md:grid-cols-2 gap-8 text-center">
                    <div class="bg-gray-50 p-6 rounded-xl border">
                        <h3 class="font-bold mb-4">${t.horizontal}</h3>
                        <div class="text-4xl font-mono flex justify-center gap-2 cursor-pointer select-none">
                            <span id="label-dividend" onclick="alertNotation('dividend')" class="hover:text-primary transition p-1">14</span><span>Ã·</span>
                            <span id="label-divisor" onclick="alertNotation('divisor')" class="hover:text-primary transition p-1">4</span><span>=</span>
                            <span id="label-quotient" onclick="alertNotation('quotient')" class="hover:text-primary transition p-1">3</span><span class="text-gray-400">...</span>
                            <span id="label-remainder" onclick="alertNotation('remainder')" class="hover:text-primary transition p-1">2</span>
                        </div>
                    </div>
                    <div id="notation-info" class="bg-indigo-50 p-6 rounded-xl border-2 border-indigo-200 flex items-center justify-center text-indigo-800 italic min-h-[120px]">
                        ${t.desc}
                    </div>
                </div>
            `;
        }

        function alertNotation(key) {
            const t = getText('notation');
            const info = document.getElementById('notation-info');
            if(!info) return;
            info.innerHTML = `<div><h4 class="font-bold text-xl text-primary mb-1">${t[key]}</h4><p class="text-gray-700">${t[key+'Desc']}</p></div>`;
            
            document.querySelectorAll('.text-primary').forEach(el => el.classList.remove('text-primary', 'font-bold'));
            document.getElementById(`label-${key}`).classList.add('text-primary', 'font-bold');
        }

        // --- VERTICAL ---
        function renderVertical(container) {
            const t = getText('verticalStep');
            container.innerHTML = `
                <h2 class="text-2xl font-bold text-gray-800 mb-2">${t.title}</h2>
                <div class="flex flex-col lg:flex-row gap-8 mt-6">
                    <!-- Grid Display (Left) -->
                    <div class="bg-indigo-900 text-white p-8 rounded-3xl shadow-2xl mx-auto w-full max-w-sm">
                        <div class="division-grid" id="v-grid">
                            <div></div><div></div><div id="cell-q1" class="v-hidden">2</div><div id="cell-q2" class="v-hidden">5</div><div></div>
                            <div class="text-emerald-400">3</div>
                            <div class="border-t-4 border-l-4 border-white rounded-tl-xl col-span-2 text-left pl-3 tracking-widest">
                                <span id="digit-7">7</span><span id="digit-5">5</span>
                            </div><div></div><div></div>
                            <div></div><div></div><div id="cell-m1" class="v-hidden">6</div><div></div><div></div>
                            <div></div><div id="line-1" class="col-span-3 v-hidden v-line-sub"></div><div></div>
                            <div></div><div></div><div id="cell-r1" class="v-hidden">1</div><div id="cell-d1" class="v-hidden text-emerald-300">5</div><div></div>
                            <div></div><div></div><div id="cell-m2-a" class="v-hidden">1</div><div id="cell-m2-b" class="v-hidden">5</div><div></div>
                            <div></div><div id="line-2" class="col-span-3 v-hidden v-line-sub"></div><div></div>
                            <div></div><div></div><div></div><div id="cell-r2" class="v-hidden">0</div><div></div>
                        </div>
                    </div>
                    
                    <!-- Steps Sidebar (Right) -->
                    <div class="flex-1 flex flex-col space-y-4">
                        <div class="bg-gray-50 border border-gray-200 rounded-2xl overflow-hidden flex flex-col h-[350px]">
                            <div class="bg-gray-100 px-4 py-2 font-bold text-gray-600 border-b">${t.problem}</div>
                            <div id="v-steps-container" class="flex-1 overflow-y-auto p-2 space-y-1">
                                <!-- Steps list will be injected here -->
                            </div>
                        </div>
                        <div class="flex gap-3">
                            <button id="v-btn-next" onclick="nextVStep()" class="flex-1 bg-primary text-white py-4 rounded-xl text-xl font-bold shadow-lg hover:bg-indigo-700 active:scale-95 transition-all flex items-center justify-center gap-2">
                                <i data-lucide="play-circle"></i> ${t.btnNext}
                            </button>
                            <button onclick="resetVStep()" class="bg-gray-200 text-gray-700 px-6 py-4 rounded-xl font-bold hover:bg-gray-300 transition-all">
                                <i data-lucide="rotate-ccw"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;

            // Inject all step texts
            const stepsContainer = document.getElementById('v-steps-container');
            for(let i=0; i<=10; i++) {
                const stepDiv = document.createElement('div');
                stepDiv.id = `text-step-${i}`;
                stepDiv.className = `step-item p-3 rounded-lg text-sm md:text-base text-gray-500`;
                stepDiv.innerText = t[`step${i}`];
                stepsContainer.appendChild(stepDiv);
            }

            currentVStep = 0;
            updateStepHighlight();
            lucide.createIcons();
        }

        const vStepActions = [
            { show: [], highlightDigit: null, highlightCell: null }, // Step 0
            { show: [], highlightDigit: 'digit-7' }, // Step 1
            { show: ['cell-q1'], highlightCell: 'cell-q1' }, // Step 2
            { show: ['cell-m1'], highlightCell: 'cell-m1' }, // Step 3
            { show: ['line-1', 'cell-r1'], highlightCell: 'cell-r1' }, // Step 4
            { show: ['cell-d1'], highlightCell: 'cell-d1' }, // Step 5
            { show: [], highlightDigit: 'cell-d1' }, // Step 6
            { show: ['cell-q2'], highlightCell: 'cell-q2' }, // Step 7
            { show: ['cell-m2-a', 'cell-m2-b'] }, // Step 8
            { show: ['line-2', 'cell-r2'], highlightCell: 'cell-r2' }, // Step 9
            { show: [] } // Step 10
        ];

        function nextVStep() {
            if (currentVStep >= vStepActions.length - 1) return;
            currentVStep++;
            const action = vStepActions[currentVStep];
            
            // Show corresponding grid elements
            if(action.show) {
                action.show.forEach(id => {
                    const el = document.getElementById(id);
                    if(el) { el.classList.remove('v-hidden'); el.classList.add('v-visible'); }
                });
            }
            
            // Highlight specific digits/cells in grid
            document.querySelectorAll('.v-step-active, .digit-highlight').forEach(el => el.classList.remove('v-step-active', 'digit-highlight'));
            if(action.highlightDigit) {
                const dEl = document.getElementById(action.highlightDigit);
                if(dEl) dEl.classList.add('digit-highlight');
            }
            if(action.highlightCell) {
                const cEl = document.getElementById(action.highlightCell);
                if(cEl) cEl.classList.add('v-step-active');
            }
            
            // Update the sidebar text highlight
            updateStepHighlight();
            
            if (currentVStep === vStepActions.length - 1) {
                const btn = document.getElementById('v-btn-next');
                if(btn) btn.classList.add('opacity-50', 'cursor-not-allowed');
            }
        }

        function updateStepHighlight() {
            document.querySelectorAll('.step-item').forEach((el, index) => {
                if(index === currentVStep) {
                    el.classList.add('active');
                    el.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                } else {
                    el.classList.remove('active');
                }
            });
        }

        function resetVStep() { renderContent(); }

        // --- PRACTICE ---
        function renderPractice(container) {
            const t = getText('practice');
            container.innerHTML = `
                <div class="text-center max-w-md mx-auto">
                    <h2 class="text-2xl font-bold text-primary mb-6">${t.title}</h2>
                    <div class="bg-white border-2 border-gray-100 shadow-lg rounded-2xl p-8 mb-6">
                        <div class="text-gray-400 text-sm mb-4 uppercase tracking-widest">${t.question}</div>
                        <div class="text-5xl font-mono font-bold text-gray-800 mb-8" id="p-question"></div>
                        <input type="number" id="p-input" class="w-full text-center text-3xl p-3 border-2 rounded-xl mb-4 focus:border-primary outline-none" placeholder="?">
                        <div id="p-feedback" class="h-8 text-lg font-bold mb-4"></div>
                        <button id="p-btn" onclick="checkAnswer()" class="w-full bg-primary text-white text-lg font-bold py-3 rounded-xl shadow-lg hover:bg-indigo-700 transition">${t.check}</button>
                    </div>
                    <div class="text-gray-400 font-mono" id="p-score">${t.score} ${pScore}</div>
                </div>
            `;
            newQuestion();
        }

        function newQuestion() {
            const B = Math.floor(Math.random() * 8) + 2; 
            const C = Math.floor(Math.random() * 9) + 1; 
            const A = B * C;
            currentQ = { A, B, answer: C };
            const q = document.getElementById('p-question');
            if(q) q.innerText = `${A} Ã· ${B} = ?`;
            const input = document.getElementById('p-input');
            if(input) { input.value = ''; input.disabled = false; input.focus(); }
            const fb = document.getElementById('p-feedback');
            if(fb) fb.innerText = '';
            const btn = document.getElementById('p-btn');
            if(btn) { 
                btn.innerText = getText('practice.check'); 
                btn.onclick = checkAnswer;
                btn.classList.remove('bg-secondary');
                btn.classList.add('bg-primary');
            }
        }

        function checkAnswer() {
            const input = document.getElementById('p-input');
            if(!input) return;
            const val = parseInt(input.value);
            const t = getText('practice');
            const fb = document.getElementById('p-feedback');
            const btn = document.getElementById('p-btn');
            
            if(val === currentQ.answer) {
                fb.innerText = t.correct;
                fb.className = "h-8 text-lg font-bold mb-4 text-secondary";
                pScore += 10;
                document.getElementById('p-score').innerText = t.score + pScore;
                input.disabled = true;
                btn.innerText = t.next;
                btn.classList.remove('bg-primary');
                btn.classList.add('bg-secondary');
                btn.onclick = newQuestion;
            } else {
                fb.innerText = t.wrong;
                fb.className = "h-8 text-lg font-bold mb-4 text-red-500";
                input.value = '';
                input.focus();
            }
        }

        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
