<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>100以內的數 / Numbers up to 100</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Lexend:wght@400;600;800&display=swap');
        
        :root {
            --unit-size: 24px;
            --ten-color: #f59e0b;
            --one-color: #3b82f6;
        }

        body {
            font-family: 'Lexend', 'Microsoft JhengHei', sans-serif;
            touch-action: manipulation;
            background-color: #f0f9ff;
            user-select: none;
        }

        /* 十位長條 - 每一格與個位方塊等大 */
        .block-ten {
            width: var(--unit-size);
            height: calc(var(--unit-size) * 10); 
            background-color: var(--ten-color);
            border: 2px solid #b45309;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 2px 2px 0px rgba(180, 83, 9, 0.2);
            flex-shrink: 0;
        }

        .block-unit-segment {
            width: 100%;
            height: var(--unit-size);
            border-bottom: 1px solid #b45309;
        }

        .block-unit-segment:last-child {
            border-bottom: none;
        }

        /* 個位獨立方塊 - 大小與十位的一格相同 */
        .single-unit {
            width: var(--unit-size);
            height: var(--unit-size);
            background-color: var(--one-color);
            border: 2px solid #1d4ed8;
            border-radius: 4px;
            box-shadow: 2px 2px 0px rgba(29, 78, 216, 0.2);
            flex-shrink: 0;
        }

        /* 比較模式的小型組件 */
        .mini-ten {
            width: 12px;
            height: 60px;
            background-color: var(--ten-color);
            border: 1px solid #b45309;
            border-radius: 2px;
            flex-shrink: 0;
        }

        .mini-one {
            width: 12px;
            height: 12px;
            background-color: var(--one-color);
            border: 1px solid #1d4ed8;
            border-radius: 1px;
            flex-shrink: 0;
        }

        .tab-active {
            background-color: #3b82f6 !important;
            color: white !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }

        /* 趣味百數表樣式 */
        .number-grid-item {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            border-radius: 8px;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            font-weight: 600;
            background: white;
            border: 1px solid #e2e8f0;
        }

        .number-grid-item.highlight {
            background: #fef3c7;
            border-color: #f59e0b;
            color: #b45309;
            transform: scale(0.92);
        }

        .number-grid-item.active-cell {
            background: #3b82f6 !important;
            color: white !important;
            transform: scale(1.1);
            z-index: 10;
            box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.5);
            border-color: #1d4ed8;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .animate-shake {
            animation: shake 0.2s ease-in-out 0s 2;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="p-2 md:p-6">

    <div id="app" class="max-w-5xl mx-auto bg-white rounded-3xl shadow-2xl overflow-hidden flex flex-col h-[95vh]">
        
        <!-- Header -->
        <header class="bg-white border-b px-6 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <!-- Logo 預留位置 -->
                <div class="flex items-center justify-center bg-slate-50 rounded-xl overflow-hidden p-1 border border-slate-100">
                    <img id="app-logo" src="logo.png" alt="Logo" class="h-10 w-auto object-contain min-w-[40px]" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                    <span class="hidden px-3 py-1 font-bold text-slate-400 text-xs uppercase tracking-widest">Math Lab</span>
                </div>
                <h1 id="title" class="text-xl md:text-2xl font-extrabold text-slate-800 tracking-tight">認識 100 以內的數</h1>
            </div>
            <button onclick="toggleLanguage()" class="bg-slate-100 hover:bg-slate-200 px-5 py-2 rounded-full text-sm font-bold text-slate-700 transition-colors">
                EN / 中文
            </button>
        </header>

        <!-- Navigation Tabs -->
        <nav class="flex p-2 bg-slate-50 border-b overflow-x-auto no-scrollbar">
            <button onclick="switchTab('counting')" id="tab-counting" class="flex-1 py-3 px-2 rounded-xl font-bold text-slate-500 whitespace-nowrap transition-all mx-1 tab-active">
                <span class="block text-[10px] uppercase opacity-60">Level 1</span>
                <span class="tab-label">100 數數看</span>
            </button>
            <button onclick="switchTab('tens')" id="tab-tens" class="flex-1 py-3 px-2 rounded-xl font-bold text-slate-500 whitespace-nowrap transition-all mx-1">
                <span class="block text-[10px] uppercase opacity-60">Level 2</span>
                <span class="tab-label">每 10 個一數</span>
            </button>
            <button onclick="switchTab('placevalue')" id="tab-placevalue" class="flex-1 py-3 px-2 rounded-xl font-bold text-slate-500 whitespace-nowrap transition-all mx-1">
                <span class="block text-[10px] uppercase opacity-60">Level 3</span>
                <span class="tab-label">位值概念</span>
            </button>
            <button onclick="switchTab('compare')" id="tab-compare" class="flex-1 py-3 px-2 rounded-xl font-bold text-slate-500 whitespace-nowrap transition-all mx-1">
                <span class="block text-[10px] uppercase opacity-60">Level 4</span>
                <span class="tab-label">大小比較</span>
            </button>
        </nav>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto p-4 md:p-6 bg-white relative">
            
            <!-- Tab 1: 100 Counting -->
            <section id="section-counting" class="space-y-4">
                <div class="flex flex-col md:flex-row gap-4 items-center justify-between bg-blue-50 p-4 rounded-2xl border border-blue-100">
                    <div class="space-y-1">
                        <p class="text-blue-800 font-bold instruction">點擊數字或選擇規律來探索！</p>
                        <div id="game-info" class="text-sm text-blue-600 font-bold h-5"></div>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        <button onclick="highlightPattern('even')" class="bg-white px-3 py-1 rounded-lg text-xs font-bold border shadow-sm btn-pattern-even hover:bg-blue-100 transition-colors">偶數</button>
                        <button onclick="highlightPattern('5s')" class="bg-white px-3 py-1 rounded-lg text-xs font-bold border shadow-sm btn-pattern-5s hover:bg-blue-100 transition-colors">5的倍數</button>
                        <button onclick="highlightPattern('10s')" class="bg-white px-3 py-1 rounded-lg text-xs font-bold border shadow-sm btn-pattern-10s hover:bg-blue-100 transition-colors">10的倍數</button>
                        <button onclick="startFindGame()" class="bg-yellow-400 px-3 py-1 rounded-lg text-xs font-bold border shadow-sm text-yellow-900 btn-game hover:bg-yellow-300 transition-transform active:scale-95">尋寶遊戲</button>
                        <button onclick="resetGrid()" class="bg-slate-200 px-3 py-1 rounded-lg text-xs font-bold btn-reset hover:bg-slate-300 transition-colors">重置</button>
                    </div>
                </div>
                <div id="grid-100" class="grid grid-cols-10 gap-1 max-w-xl mx-auto border-4 border-slate-100 p-2 rounded-2xl bg-white shadow-inner">
                    <!-- JS Injected -->
                </div>
            </section>

            <!-- Tab 2: Counting by Tens -->
            <section id="section-tens" class="hidden space-y-8 text-center pt-10">
                <p class="text-lg text-slate-600 instruction">拖動滑桿來練習每 10 個一數</p>
                <div class="flex flex-wrap justify-center gap-4 min-h-[250px] items-end px-4" id="tens-visualizer">
                </div>
                <div class="max-w-md mx-auto">
                    <input type="range" id="tens-slider" min="0" max="100" step="10" value="0" class="w-full h-3 bg-blue-100 rounded-lg appearance-none cursor-pointer accent-blue-600" oninput="updateTensView()">
                    <div class="flex justify-between mt-3 text-slate-400 font-bold text-sm">
                        <span>0</span><span>20</span><span>40</span><span>60</span><span>80</span><span>100</span>
                    </div>
                </div>
                <div class="text-8xl font-black text-blue-600 tabular-nums" id="tens-display">0</div>
            </section>

            <!-- Tab 3: Place Value -->
            <section id="section-placevalue" class="hidden">
                <div class="flex flex-col md:flex-row gap-10 items-center justify-center pt-6">
                    <!-- 設定面板 -->
                    <div class="bg-slate-50 p-8 rounded-[40px] w-full md:w-72 space-y-8 shadow-inner border border-slate-100">
                        <div class="text-center">
                            <label class="block text-slate-400 font-bold mb-4 uppercase text-xs tracking-widest label-number">設定數字</label>
                            <div class="flex items-center justify-center gap-4">
                                <button onclick="adjustPV(-1)" class="w-12 h-12 bg-white rounded-2xl shadow-md border text-2xl font-bold text-slate-400 active:scale-90 transition-transform">-</button>
                                <input type="number" id="pv-input" value="25" min="0" max="99" class="text-5xl font-black text-center w-24 bg-transparent text-blue-600 outline-none" oninput="updatePlaceValue()">
                                <button onclick="adjustPV(1)" class="w-12 h-12 bg-white rounded-2xl shadow-md border text-2xl font-bold text-slate-400 active:scale-90 transition-transform">+</button>
                            </div>
                        </div>
                    </div>

                    <!-- 積木顯示區 -->
                    <div class="flex-1 flex justify-around w-full max-w-lg items-end min-h-[350px] border-b-[12px] border-slate-100 pb-10 px-4">
                        <div class="text-center">
                            <div id="tens-container" class="flex flex-wrap gap-3 justify-center max-w-[180px] items-end"></div>
                            <div class="mt-8 font-extrabold text-amber-600 text-lg uppercase tracking-tighter label-tens">十位</div>
                            <div id="tens-digit" class="text-6xl font-black text-amber-600 mt-2">2</div>
                        </div>
                        <div class="text-center">
                            <div id="ones-container" class="flex flex-wrap gap-3 justify-center max-w-[180px] items-end"></div>
                            <div class="mt-8 font-extrabold text-blue-600 text-lg uppercase tracking-tighter label-ones">個位</div>
                            <div id="ones-digit" class="text-6xl font-black text-blue-600 mt-2">5</div>
                        </div>
                    </div>
                </div>
                <div class="mt-12 text-center">
                    <p class="text-xl md:text-2xl font-bold text-slate-700 bg-slate-50 inline-block px-8 py-4 rounded-full border border-slate-100 shadow-sm" id="pv-explanation"></p>
                </div>
            </section>

            <!-- Tab 4: Comparison -->
            <section id="section-compare" class="hidden space-y-12 pt-6">
                <div class="flex items-start justify-center gap-4 md:gap-16">
                    <div class="text-center">
                        <div id="comp-a-val" class="text-7xl font-black text-slate-800 mb-6">42</div>
                        <div id="comp-a-visual" class="flex flex-col items-center gap-4 bg-slate-50 rounded-[30px] p-6 min-w-[140px] shadow-inner border border-slate-100">
                            <div class="comp-tens flex flex-wrap gap-2 justify-center"></div>
                            <div class="comp-ones flex flex-wrap gap-1 justify-center max-w-[80px]"></div>
                        </div>
                    </div>
                    
                    <div id="comp-operator" class="w-24 h-24 bg-blue-600 rounded-full flex items-center justify-center text-5xl font-bold text-white shadow-xl transition-all mt-20">?</div>

                    <div class="text-center">
                        <div id="comp-b-val" class="text-7xl font-black text-slate-800 mb-6">38</div>
                        <div id="comp-b-visual" class="flex flex-col items-center gap-4 bg-slate-50 rounded-[30px] p-6 min-w-[140px] shadow-inner border border-slate-100">
                            <div class="comp-tens flex flex-wrap gap-2 justify-center"></div>
                            <div class="comp-ones flex flex-wrap gap-1 justify-center max-w-[80px]"></div>
                        </div>
                    </div>
                </div>

                <div class="flex justify-center gap-8">
                    <button onclick="checkAnswer('<')" class="bg-white border-4 border-slate-100 hover:border-blue-500 w-24 h-24 rounded-[32px] text-4xl font-bold text-slate-700 transition-all active:scale-90 shadow-md">&lt;</button>
                    <button onclick="checkAnswer('=')" class="bg-white border-4 border-slate-100 hover:border-blue-500 w-24 h-24 rounded-[32px] text-4xl font-bold text-slate-700 transition-all active:scale-90 shadow-md">=</button>
                    <button onclick="checkAnswer('>')" class="bg-white border-4 border-slate-100 hover:border-blue-500 w-24 h-24 rounded-[32px] text-4xl font-bold text-slate-700 transition-all active:scale-90 shadow-md">&gt;</button>
                </div>
                
                <div class="text-center">
                    <button onclick="generateComparison()" class="bg-slate-900 text-white px-12 py-5 rounded-3xl font-bold text-xl hover:bg-slate-800 btn-new shadow-lg transition-transform active:scale-95">下一題</button>
                </div>
            </section>

        </main>
        
        <!-- Feedback Toast -->
        <div id="feedback" class="fixed bottom-10 left-1/2 transform -translate-x-1/2 opacity-0 transition-all duration-300 pointer-events-none px-10 py-5 rounded-3xl text-white font-black text-2xl shadow-2xl z-50">
            Success!
        </div>
    </div>

    <script>
        const i18n = {
            zh: {
                title: "認識 100 以內的數",
                tabs: ["100 數數看", "每 10 個一數", "位值概念", "大小比較"],
                instructions: {
                    counting: "點擊數字或選擇規律來探索！",
                    tens: "拖動滑桿來練習每 10 個一數",
                    placevalue: "調整數字來觀察位值變化",
                    compare: "比較兩個數的大小"
                },
                labels: {
                    setNum: "設定數字",
                    tens: "十位",
                    ones: "個位",
                    next: "下一題",
                    expl: (n, t, o) => `${n} 是由 ${t} 個十和 ${o} 個一組成的。`,
                    find: (n) => `請找出數字： ${n}`,
                    even: "偶數",
                    five: "5的倍數",
                    ten: "10的倍數",
                    game: "尋寶遊戲",
                    reset: "重置"
                },
                correct: "太棒了！正確！",
                wrong: "不對喔，再找找看！"
            },
            en: {
                title: "Number Sense 1-100",
                tabs: ["100 Grid", "Count by 10s", "Place Value", "Comparison"],
                instructions: {
                    counting: "Tap numbers or patterns to explore!",
                    tens: "Slide to count by tens",
                    placevalue: "Adjust number to see place value",
                    compare: "Compare the two numbers"
                },
                labels: {
                    setNum: "Set Number",
                    tens: "Tens",
                    ones: "Ones",
                    next: "Next Challenge",
                    expl: (n, t, o) => `${n} is made of ${t} tens and ${o} ones.`,
                    find: (n) => `Find the number: ${n}`,
                    even: "Evens",
                    five: "Multiples of 5",
                    ten: "Multiples of 10",
                    game: "Find Game",
                    reset: "Reset"
                },
                correct: "Great! Correct!",
                wrong: "Not quite, try again!"
            }
        };

        let currentLang = 'zh';
        let currentTab = 'counting';
        let targetGameNum = null;

        function toggleLanguage() {
            currentLang = currentLang === 'zh' ? 'en' : 'zh';
            updateUIStrings();
        }

        function updateUIStrings() {
            const strings = i18n[currentLang];
            document.getElementById('title').textContent = strings.title;
            const tabs = document.querySelectorAll('nav .tab-label');
            strings.tabs.forEach((text, i) => { if(tabs[i]) tabs[i].textContent = text; });
            document.querySelectorAll('.instruction').forEach(el => {
                const parentId = el.closest('section').id;
                const key = parentId.replace('section-', '');
                el.textContent = strings.instructions[key];
            });
            document.querySelector('.label-number').textContent = strings.labels.setNum;
            document.querySelectorAll('.label-tens').forEach(el => el.textContent = strings.labels.tens);
            document.querySelectorAll('.label-ones').forEach(el => el.textContent = strings.labels.ones);
            document.querySelector('.btn-new').textContent = strings.labels.next;
            
            document.querySelector('.btn-pattern-even').textContent = strings.labels.even;
            document.querySelector('.btn-pattern-5s').textContent = strings.labels.five;
            document.querySelector('.btn-pattern-10s').textContent = strings.labels.ten;
            document.querySelector('.btn-game').textContent = strings.labels.game;
            document.querySelector('.btn-reset').textContent = strings.labels.reset;

            if(targetGameNum) document.getElementById('game-info').textContent = strings.labels.find(targetGameNum);
            updatePlaceValue();
        }

        function switchTab(tabId) {
            currentTab = tabId;
            targetGameNum = null;
            document.getElementById('game-info').textContent = "";
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById(`section-${tabId}`).classList.remove('hidden');
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('tab-active'));
            document.getElementById(`tab-${tabId}`).classList.add('tab-active');
            
            if (tabId === 'counting') initGrid();
            if (tabId === 'tens') updateTensView();
            if (tabId === 'placevalue') updatePlaceValue();
            if (tabId === 'compare') generateComparison();
        }

        function initGrid() {
            const grid = document.getElementById('grid-100');
            if (!grid) return;
            grid.innerHTML = '';
            for (let i = 1; i <= 100; i++) {
                const btn = document.createElement('div');
                btn.className = 'number-grid-item';
                btn.textContent = i;
                btn.id = `cell-${i}`;
                btn.onclick = () => handleCellClick(i);
                grid.appendChild(btn);
            }
        }

        function handleCellClick(n) {
            const strings = i18n[currentLang];
            const cell = document.getElementById(`cell-${n}`);
            if (!cell) return;
            
            if (targetGameNum) {
                if (n === targetGameNum) {
                    showFeedback(strings.correct, true);
                    cell.classList.add('active-cell');
                    targetGameNum = null;
                    document.getElementById('game-info').textContent = "";
                } else {
                    showFeedback(strings.wrong, false);
                    cell.classList.add('animate-shake');
                    setTimeout(() => cell.classList.remove('animate-shake'), 400);
                }
            } else {
                cell.classList.toggle('active-cell');
            }
        }

        function highlightPattern(type) {
            resetGrid();
            for (let i = 1; i <= 100; i++) {
                const cell = document.getElementById(`cell-${i}`);
                if (!cell) continue;
                if (type === 'even' && i % 2 === 0) cell.classList.add('highlight');
                if (type === '5s' && i % 5 === 0) cell.classList.add('highlight');
                if (type === '10s' && i % 10 === 0) cell.classList.add('highlight');
            }
        }

        function startFindGame() {
            resetGrid();
            targetGameNum = Math.floor(Math.random() * 100) + 1;
            document.getElementById('game-info').textContent = i18n[currentLang].labels.find(targetGameNum);
        }

        function resetGrid() {
            targetGameNum = null;
            const info = document.getElementById('game-info');
            if(info) info.textContent = "";
            document.querySelectorAll('.number-grid-item').forEach(el => {
                el.className = 'number-grid-item';
            });
        }

        function createTenBlock(isMini = false) {
            const block = document.createElement('div');
            block.className = isMini ? 'mini-ten' : 'block-ten';
            if (!isMini) {
                for (let j = 0; j < 10; j++) {
                    const seg = document.createElement('div');
                    seg.className = 'block-unit-segment';
                    block.appendChild(seg);
                }
            }
            return block;
        }

        function updateTensView() {
            const val = parseInt(document.getElementById('tens-slider').value);
            document.getElementById('tens-display').textContent = val;
            const visual = document.getElementById('tens-visualizer');
            if (!visual) return;
            visual.innerHTML = '';
            for (let i = 0; i < val / 10; i++) visual.appendChild(createTenBlock());
        }

        function adjustPV(delta) {
            const input = document.getElementById('pv-input');
            if (!input) return;
            let val = (parseInt(input.value) || 0) + delta;
            val = Math.max(0, Math.min(99, val));
            input.value = val;
            updatePlaceValue();
        }

        function updatePlaceValue() {
            const valInput = document.getElementById('pv-input');
            const val = valInput ? (parseInt(valInput.value) || 0) : 0;
            const tens = Math.floor(val / 10);
            const ones = val % 10;
            
            const tensDigit = document.getElementById('tens-digit');
            const onesDigit = document.getElementById('ones-digit');
            if (tensDigit) tensDigit.textContent = tens;
            if (onesDigit) onesDigit.textContent = ones;
            
            const tContainer = document.getElementById('tens-container');
            const oContainer = document.getElementById('ones-container');
            if (tContainer) tContainer.innerHTML = ''; 
            if (oContainer) oContainer.innerHTML = '';
            
            for (let i = 0; i < tens; i++) if(tContainer) tContainer.appendChild(createTenBlock());
            for (let i = 0; i < ones; i++) {
                const o = document.createElement('div');
                o.className = 'single-unit';
                if(oContainer) oContainer.appendChild(o);
            }
            const expl = document.getElementById('pv-explanation');
            if(expl) expl.textContent = i18n[currentLang].labels.expl(val, tens, ones);
        }

        let targetOp = '';
        function generateComparison() {
            const a = Math.floor(Math.random() * 95) + 1;
            const b = Math.floor(Math.random() * 95) + 1;
            const compA = document.getElementById('comp-a-val');
            const compB = document.getElementById('comp-b-val');
            if(compA) compA.textContent = a;
            if(compB) compB.textContent = b;

            const opDisplay = document.getElementById('comp-operator');
            if(opDisplay) {
                opDisplay.textContent = '?';
                opDisplay.className = 'w-24 h-24 bg-blue-600 rounded-full flex items-center justify-center text-5xl font-bold text-white shadow-xl mt-20';
            }
            targetOp = a > b ? '>' : (a < b ? '<' : '=');
            renderComparisonVisual('comp-a-visual', a);
            renderComparisonVisual('comp-b-visual', b);
        }

        function renderComparisonVisual(parentId, val) {
            const parent = document.getElementById(parentId);
            if (!parent) return;
            const tensContainer = parent.querySelector('.comp-tens');
            const onesContainer = parent.querySelector('.comp-ones');
            if(tensContainer) tensContainer.innerHTML = ''; 
            if(onesContainer) onesContainer.innerHTML = '';
            
            const tens = Math.floor(val / 10);
            const ones = val % 10;
            for (let i = 0; i < tens; i++) if(tensContainer) tensContainer.appendChild(createTenBlock(true));
            for (let i = 0; i < ones; i++) {
                const o = document.createElement('div');
                o.className = 'mini-one';
                if(onesContainer) onesContainer.appendChild(o);
            }
        }

        function checkAnswer(choice) {
            const opDisplay = document.getElementById('comp-operator');
            const strings = i18n[currentLang];
            if (choice === targetOp) {
                showFeedback(strings.correct, true);
                if(opDisplay) {
                    opDisplay.textContent = targetOp;
                    opDisplay.classList.replace('bg-blue-600', 'bg-green-500');
                }
            } else {
                showFeedback(strings.wrong, false);
                if(opDisplay) {
                    opDisplay.classList.add('animate-shake');
                    setTimeout(() => opDisplay.classList.remove('animate-shake'), 400);
                }
            }
        }

        function showFeedback(text, isSuccess) {
            const el = document.getElementById('feedback');
            if (!el) return;
            el.textContent = text;
            el.className = `fixed bottom-10 left-1/2 transform -translate-x-1/2 px-10 py-5 rounded-3xl text-white font-black text-2xl shadow-2xl z-50 transition-all ${isSuccess ? 'bg-green-500' : 'bg-red-500'} opacity-100`;
            setTimeout(() => { el.style.opacity = '0'; }, 1500);
        }

        window.onload = () => {
            initGrid();
            updateUIStrings();
        };
    </script>
</body>
</html>
