<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Math Concept Simulator</title>
    <!-- Tailwind CSS for Responsive Design -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for better Chinese/English typography -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Fredoka', 'Noto Sans TC', sans-serif;
            background-color: #f0f9ff;
            /* Prevent scrolling on iPad when interacting with game elements */
            touch-action: manipulation; 
        }

        /* Custom Styles for Visuals */
        .counter {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            margin: 4px;
            font-weight: bold;
            color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .counter-group {
            border: 2px dashed #cbd5e1;
            border-radius: 12px;
            padding: 10px;
            min-height: 80px;
            background-color: white;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
        }

        .counter.blue { background-color: #3b82f6; }
        .counter.red { background-color: #ef4444; }
        .counter.faded { opacity: 0.3; transform: scale(0.9); text-decoration: line-through; }
        
        .swap-anim {
            animation: swapMove 1s ease-in-out;
        }

        /* Specific iPad/Tablet Optimization */
        @media (min-width: 768px) {
            .counter { width: 50px; height: 50px; font-size: 1.2rem; }
            .container-grid { display: grid; grid-template-columns: 250px 1fr; gap: 20px; height: calc(100vh - 100px); }
            .sidebar { height: 100%; overflow-y: auto; }
            .main-stage { height: 100%; overflow-y: auto; display: flex; flex-direction: column; justify-content: center; }
        }

        /* Mobile specific adjustments */
        @media (max-width: 767px) {
            .container-grid { display: flex; flex-direction: column; }
            .nav-btn { padding: 12px; font-size: 1rem; }
        }
    </style>
</head>
<body class="text-slate-700">

    <!-- Top Bar / Logo Area -->
    <header class="bg-white shadow-sm p-4 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-4">
                <!-- LOGO PLACEHOLDER: Will show text if logo.png is missing -->
                <div class="h-12 w-auto">
                    <img src="logo.png" alt="Logo" class="h-full object-contain" onerror="this.style.display='none'; document.getElementById('logo-text').style.display='block'">
                    <h1 id="logo-text" class="text-2xl font-bold text-blue-600 hidden" data-en="Math Learning" data-tc="Êï∏Â≠∏Ê®ÇÂúí">Êï∏Â≠∏Ê®ÇÂúí</h1>
                </div>
            </div>
            
            <button onclick="toggleLanguage()" class="bg-indigo-100 text-indigo-700 px-4 py-2 rounded-full font-bold hover:bg-indigo-200 transition">
                <span id="lang-btn-text">English</span>
            </button>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="max-w-7xl mx-auto p-4">
        <div class="container-grid">
            
            <!-- Sidebar Navigation (Mode Selection) -->
            <aside class="sidebar bg-white rounded-2xl shadow-lg p-4 flex flex-col gap-3">
                <h2 class="text-lg font-bold text-slate-400 mb-2 uppercase tracking-wider text-center" data-en="Modes" data-tc="Â≠∏ÁøíÊ®°Âºè">Â≠∏ÁøíÊ®°Âºè</h2>
                
                <button onclick="setMode('addition')" id="btn-add" class="nav-btn bg-blue-100 hover:bg-blue-500 hover:text-white text-blue-700 p-4 rounded-xl font-bold text-left transition flex items-center gap-3">
                    <span class="text-2xl">+</span> <span data-en="Addition (1-18)" data-tc="Âä†Ê≥ïÁ∑¥Áøí (18‰ª•ÂÖß)">Âä†Ê≥ïÁ∑¥Áøí (18‰ª•ÂÖß)</span>
                </button>

                <button onclick="setMode('subtraction')" id="btn-sub" class="nav-btn bg-red-100 hover:bg-red-500 hover:text-white text-red-700 p-4 rounded-xl font-bold text-left transition flex items-center gap-3">
                    <span class="text-2xl">-</span> <span data-en="Subtraction (1-18)" data-tc="Ê∏õÊ≥ïÁ∑¥Áøí (18‰ª•ÂÖß)">Ê∏õÊ≥ïÁ∑¥Áøí (18‰ª•ÂÖß)</span>
                </button>

                <button onclick="setMode('zero')" id="btn-zero" class="nav-btn bg-green-100 hover:bg-green-500 hover:text-white text-green-700 p-4 rounded-xl font-bold text-left transition flex items-center gap-3">
                    <span class="text-2xl">0</span> <span data-en="Concept of Zero" data-tc="Ë™çË≠ò 0 ÁöÑÊ¶ÇÂøµ">Ë™çË≠ò 0 ÁöÑÊ¶ÇÂøµ</span>
                </button>

                <button onclick="setMode('commutative')" id="btn-comm" class="nav-btn bg-purple-100 hover:bg-purple-500 hover:text-white text-purple-700 p-4 rounded-xl font-bold text-left transition flex items-center gap-3">
                    <span class="text-2xl">‚áÑ</span> <span data-en="Commutative Prop." data-tc="Âä†Ê≥ï‰∫§ÊèõÊÄßË≥™">Âä†Ê≥ï‰∫§ÊèõÊÄßË≥™</span>
                </button>
            </aside>

            <!-- Main Stage (Interaction Area) -->
            <section class="main-stage bg-white rounded-2xl shadow-lg p-6 relative">
                
                <!-- Current Mode Title -->
                <div class="text-center mb-6">
                    <h2 id="mode-title" class="text-3xl font-bold text-slate-700"></h2>
                    <p id="mode-desc" class="text-slate-500 mt-2"></p>
                </div>

                <!-- Visualization Area -->
                <div id="visual-container" class="bg-slate-50 rounded-xl p-6 mb-6 min-h-[200px] flex flex-col justify-center items-center gap-4">
                    <!-- Dynamic counters will be injected here -->
                </div>

                <!-- Equation & Controls -->
                <div class="flex flex-col items-center gap-6">
                    <!-- The Equation -->
                    <div class="text-4xl md:text-6xl font-bold font-mono tracking-wider flex items-center gap-4 bg-slate-100 px-8 py-4 rounded-2xl border-2 border-slate-200">
                        <span id="num-a">0</span>
                        <span id="operator">+</span>
                        <span id="num-b">0</span>
                        <span>=</span>
                        <span id="answer-slot" class="text-blue-600">?</span>
                    </div>

                    <!-- Input / Interaction Controls -->
                    <div id="input-area" class="flex gap-4 items-center">
                        <input type="number" id="user-input" class="w-32 text-center text-3xl p-3 border-4 border-blue-200 rounded-xl focus:outline-none focus:border-blue-500" placeholder="?">
                        <button onclick="checkAnswer()" class="bg-blue-600 text-white px-8 py-3 rounded-xl text-xl font-bold hover:bg-blue-700 shadow-lg active:scale-95 transition" data-en="Check" data-tc="Ê™¢Êü•Á≠îÊ°à">Ê™¢Êü•Á≠îÊ°à</button>
                    </div>

                    <!-- Commutative Specific Controls (Hidden by default) -->
                    <div id="commutative-controls" class="hidden">
                        <button onclick="animateSwap()" class="bg-purple-600 text-white px-8 py-3 rounded-xl text-xl font-bold hover:bg-purple-700 shadow-lg active:scale-95 transition flex items-center gap-2">
                            <span class="text-2xl">‚áÑ</span> <span data-en="Swap Positions" data-tc="‰∫§Êèõ‰ΩçÁΩÆ">‰∫§Êèõ‰ΩçÁΩÆ</span>
                        </button>
                    </div>

                    <!-- Feedback Message -->
                    <div id="feedback" class="h-10 text-xl font-bold"></div>

                    <!-- Next Button -->
                    <button onclick="generateProblem()" id="next-btn" class="hidden bg-slate-200 text-slate-700 px-6 py-2 rounded-lg font-bold hover:bg-slate-300" data-en="Next Question" data-tc="‰∏ã‰∏ÄÈ°å">‰∏ã‰∏ÄÈ°å</button>
                </div>
            </section>
        </div>
    </main>

    <script>
        // --- State Management ---
        const state = {
            lang: 'zh-Hant', // 'zh-Hant' or 'en'
            mode: 'addition', // addition, subtraction, zero, commutative
            numA: 0,
            numB: 0,
            isSwapped: false // for commutative property
        };

        // --- Localization Data ---
        const i18n = {
            'zh-Hant': {
                modes: {
                    addition: 'Âä†Ê≥ïÁ∑¥Áøí (18‰ª•ÂÖß)',
                    subtraction: 'Ê∏õÊ≥ïÁ∑¥Áøí (18‰ª•ÂÖß)',
                    zero: 'Ë™çË≠ò 0 ÁöÑÊ¶ÇÂøµ',
                    commutative: 'Âä†Ê≥ï‰∫§ÊèõÊÄßË≥™'
                },
                desc: {
                    addition: 'Êï∏‰∏ÄÊï∏ÔºåÂêàËµ∑‰æÜÁ∏ΩÂÖ±ÊúâÂ§öÂ∞ëÔºü',
                    subtraction: 'Êï∏‰∏ÄÊï∏ÔºåÊãøËµ∞‰πãÂæåÈÇÑÂâ©‰∏ãÂ§öÂ∞ëÔºü',
                    zero: '0 ‰ª£Ë°®„ÄåÊ≤íÊúâ„Äç„ÄÇÁúãÁúãÂä†‰∏ä 0 ÊàñÊ∏õÂéª 0 ÊúÉÁôºÁîü‰ªÄÈ∫ºÔºü',
                    commutative: 'Ê≥®ÊÑèÁúãÔºÅ‰∫§ÊèõÂÖ©ÂÄãÊï∏Â≠óÁöÑÈ†ÜÂ∫èÔºåÁ∏ΩÊï∏ÊúÉÊîπËÆäÂóéÔºü'
                },
                feedback: {
                    correct: 'Á≠îÂ∞ç‰∫ÜÔºÅÂ§™Ê£í‰∫ÜÔºÅ üéâ',
                    wrong: 'ÂÜçË©¶‰∏ÄÊ¨°ÂñîÔºÅÂä†Ê≤πÔºÅ üí™',
                    empty: 'Ë´ãËº∏ÂÖ•Á≠îÊ°à',
                    swapped: 'ÁúãÔºÅÈ†ÜÂ∫èÊèõ‰∫ÜÔºå‰ΩÜÁ∏ΩÊï∏‰∏ÄÊ®£ÂñîÔºÅ'
                }
            },
            'en': {
                modes: {
                    addition: 'Addition (up to 18)',
                    subtraction: 'Subtraction (up to 18)',
                    zero: 'Concept of Zero',
                    commutative: 'Commutative Property'
                },
                desc: {
                    addition: 'Count them all. How many are there in total?',
                    subtraction: 'Count them. How many are left after taking away?',
                    zero: '0 means "nothing". See what happens when you add or subtract 0.',
                    commutative: 'Watch! If we swap the order, does the total change?'
                },
                feedback: {
                    correct: 'Correct! Great job! üéâ',
                    wrong: 'Try again! You can do it! üí™',
                    empty: 'Please enter an answer',
                    swapped: 'Look! The order changed, but the total is the same!'
                }
            }
        };

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            updateLanguageUI();
            setMode('addition');
        });

        // --- Core Functions ---

        function toggleLanguage() {
            state.lang = state.lang === 'zh-Hant' ? 'en' : 'zh-Hant';
            updateLanguageUI();
            // Refresh text based on current mode
            setMode(state.mode, false); 
        }

        function updateLanguageUI() {
            // Update Toggle Button Text
            document.getElementById('lang-btn-text').innerText = state.lang === 'zh-Hant' ? 'English' : 'ÁπÅÈ´î‰∏≠Êñá';
            
            // Update all elements with data-en/data-tc attributes
            document.querySelectorAll('[data-en]').forEach(el => {
                el.innerText = state.lang === 'zh-Hant' ? el.getAttribute('data-tc') : el.getAttribute('data-en');
            });
        }

        function setMode(mode, refresh = true) {
            state.mode = mode;
            
            // Highlight active button
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('ring-4', 'ring-blue-300', 'bg-opacity-100');
                btn.classList.add('bg-opacity-50');
            });
            const activeBtnMap = {
                'addition': 'btn-add',
                'subtraction': 'btn-sub',
                'zero': 'btn-zero',
                'commutative': 'btn-comm'
            };
            const activeBtn = document.getElementById(activeBtnMap[mode]);
            activeBtn.classList.add('ring-4', 'ring-blue-300', 'bg-opacity-100');
            activeBtn.classList.remove('bg-opacity-50');

            // Update Titles
            document.getElementById('mode-title').innerText = i18n[state.lang].modes[mode];
            document.getElementById('mode-desc').innerText = i18n[state.lang].desc[mode];

            // Configure Interface based on mode
            const inputArea = document.getElementById('input-area');
            const commControls = document.getElementById('commutative-controls');

            if (mode === 'commutative') {
                inputArea.classList.add('hidden');
                commControls.classList.remove('hidden');
            } else {
                inputArea.classList.remove('hidden');
                commControls.classList.add('hidden');
            }

            if (refresh) generateProblem();
        }

        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function generateProblem() {
            // Reset UI
            document.getElementById('feedback').innerText = '';
            document.getElementById('feedback').className = 'h-10 text-xl font-bold';
            document.getElementById('user-input').value = '';
            document.getElementById('answer-slot').innerText = '?';
            document.getElementById('next-btn').classList.add('hidden');
            
            // Logic per mode
            if (state.mode === 'addition') {
                // Sum <= 18
                state.numA = getRandomInt(1, 9);
                state.numB = getRandomInt(1, 18 - state.numA); // Ensure total <= 18
                document.getElementById('operator').innerText = '+';
            
            } else if (state.mode === 'subtraction') {
                // Minuend <= 18, Result >= 0
                state.numA = getRandomInt(2, 18);
                state.numB = getRandomInt(1, state.numA); // Ensure positive result
                document.getElementById('operator').innerText = '-';
            
            } else if (state.mode === 'zero') {
                // Either A + 0, 0 + A, or A - 0, A - A
                const type = getRandomInt(1, 3);
                const val = getRandomInt(1, 9);
                if (type === 1) { state.numA = val; state.numB = 0; document.getElementById('operator').innerText = '+'; }
                else if (type === 2) { state.numA = val; state.numB = 0; document.getElementById('operator').innerText = '-'; }
                else { state.numA = val; state.numB = val; document.getElementById('operator').innerText = '-'; } // Result 0
            
            } else if (state.mode === 'commutative') {
                state.numA = getRandomInt(1, 8);
                state.numB = getRandomInt(1, 8); // Keep sums small for clear visual
                state.isSwapped = false;
                document.getElementById('operator').innerText = '+';
                // Show Answer immediately for this concept
                document.getElementById('answer-slot').innerText = state.numA + state.numB;
            }

            renderVisuals();
            renderEquation();
        }

        function renderEquation() {
            document.getElementById('num-a').innerText = state.numA;
            document.getElementById('num-b').innerText = state.numB;
        }

        function renderVisuals() {
            const container = document.getElementById('visual-container');
            container.innerHTML = ''; // Clear previous

            // Create Group A
            const groupA = document.createElement('div');
            groupA.className = 'counter-group border-blue-300';
            groupA.id = 'group-a';
            
            // Create Group B (only if needed)
            const groupB = document.createElement('div');
            groupB.className = 'counter-group border-red-300 ml-4';
            groupB.id = 'group-b';

            if (state.mode === 'addition' || state.mode === 'commutative' || (state.mode === 'zero' && document.getElementById('operator').innerText === '+')) {
                // Show two groups
                for(let i=0; i<state.numA; i++) addCounter(groupA, 'blue', i+1);
                for(let i=0; i<state.numB; i++) addCounter(groupB, 'red', i+1);
                
                container.appendChild(groupA);
                if(state.numB > 0 || state.mode === 'commutative') container.appendChild(groupB);
                
                // Add Plus sign visual
                if ((state.numB > 0 || state.mode === 'commutative') && container.children.length > 1) {
                    const plus = document.createElement('div');
                    plus.className = 'text-3xl text-slate-400 font-bold mx-2';
                    plus.innerText = '+';
                    container.insertBefore(plus, groupB);
                }

            } else if (state.mode === 'subtraction' || (state.mode === 'zero' && document.getElementById('operator').innerText === '-')) {
                // Show one group, cross out B items
                for(let i=0; i<state.numA; i++) {
                    const isFaded = i >= (state.numA - state.numB); // Cross out from the end
                    addCounter(groupA, isFaded ? 'faded bg-red-400' : 'blue', i+1);
                }
                container.appendChild(groupA);
            }
        }

        function addCounter(parent, colorClass, number) {
            const el = document.createElement('div');
            // Check if colorClass contains specific colors, if not default to blue/red logic
            let finalClass = `counter ${colorClass}`;
            el.className = finalClass;
            el.innerText = number; // Optional: put numbers inside balls for learning
            parent.appendChild(el);
        }

        function checkAnswer() {
            const userVal = parseInt(document.getElementById('user-input').value);
            let correctVal;

            const op = document.getElementById('operator').innerText;
            if (op === '+') correctVal = state.numA + state.numB;
            else correctVal = state.numA - state.numB;

            const feedbackEl = document.getElementById('feedback');
            
            if (isNaN(userVal)) {
                feedbackEl.innerText = i18n[state.lang].feedback.empty;
                feedbackEl.className = 'text-yellow-600 font-bold';
                return;
            }

            if (userVal === correctVal) {
                feedbackEl.innerText = i18n[state.lang].feedback.correct;
                feedbackEl.className = 'text-green-600 font-bold text-xl';
                document.getElementById('answer-slot').innerText = correctVal;
                document.getElementById('next-btn').classList.remove('hidden');
                
                // Simple confetti effect (visual cue)
                document.getElementById('visual-container').classList.add('ring-4', 'ring-green-200');
                setTimeout(() => document.getElementById('visual-container').classList.remove('ring-4', 'ring-green-200'), 1000);
                
            } else {
                feedbackEl.innerText = i18n[state.lang].feedback.wrong;
                feedbackEl.className = 'text-red-600 font-bold';
                document.getElementById('user-input').value = '';
                document.getElementById('user-input').focus();
            }
        }

        // --- Commutative Property Special Logic ---
        function animateSwap() {
            const container = document.getElementById('visual-container');
            const groupA = document.getElementById('group-a');
            const groupB = document.getElementById('group-b');
            
            if (!groupA || !groupB) return;

            // Swap Logic in Data
            const temp = state.numA;
            state.numA = state.numB;
            state.numB = temp;
            state.isSwapped = !state.isSwapped;

            // Visual Animation
            // We physically move the DOM elements to represent the swap
            // But first, let's update the numbers in the equation
            renderEquation();

            // Simple DOM reordering with animation class
            container.style.opacity = '0';
            
            setTimeout(() => {
                // Clear and Redraw in new order
                renderVisuals(); 
                container.style.opacity = '1';
                
                // Add a highlight effect
                const feedbackEl = document.getElementById('feedback');
                feedbackEl.innerText = i18n[state.lang].feedback.swapped;
                feedbackEl.className = 'text-purple-600 font-bold';
                
                // Show next button after a swap or two
                document.getElementById('next-btn').classList.remove('hidden');
            }, 300);
        }

        // Allow "Enter" key to check answer
        document.getElementById('user-input').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                checkAnswer();
            }
        });

    </script>
</body>
</html>
