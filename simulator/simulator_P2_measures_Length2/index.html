<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é•·åº¦(äºŒ) Length (II) - Interactive Simulator</title>
    <!-- Tailwind CSS for layout and styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=Nunito:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Nunito', 'Noto Sans TC', sans-serif;
            background-color: #f0f9ff;
            /* Prevent bounce effect on iOS */
            overscroll-behavior: none;
        }

        /* Custom Range Slider Styling */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 28px;
            width: 28px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            margin-top: -12px; 
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 8px;
            cursor: pointer;
            background: #cbd5e1;
            border-radius: 4px;
        }

        /* Card Hover Effects */
        .option-card {
            transition: all 0.2s ease;
            cursor: pointer; /* Ensure iOS treats as clickable */
            touch-action: manipulation;
        }
        .option-card:active {
            transform: scale(0.95);
        }

        /* Meter Ruler Animation */
        .ruler-mark {
            transition: height 0.3s;
        }

        /* Hide scrollbar for clean UI */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="text-slate-700 h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-white shadow-sm z-10 flex-none">
        <div class="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-4">
                <!-- Logo Placeholder -->
                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center overflow-hidden border border-blue-200">
                    <img src="logo.png" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'" alt="School Logo" class="w-full h-full object-contain">
                    <span class="text-blue-500 text-xs font-bold hidden">LOGO</span>
                </div>
                <div>
                    <h1 class="text-xl md:text-2xl font-bold text-blue-800" data-key="title">é•·åº¦ (äºŒ)</h1>
                    <p class="text-xs text-slate-500 font-semibold" data-key="subtitle">èªè­˜ç±³èˆ‡å˜ç±³æ›ç®—</p>
                </div>
            </div>
            
            <button id="langToggle" class="bg-indigo-100 text-indigo-700 px-4 py-2 rounded-full font-bold text-sm hover:bg-indigo-200 transition shadow-sm border border-indigo-200 flex items-center gap-2">
                <i class="fa-solid fa-language"></i>
                <span id="langText">English</span>
            </button>
        </div>
    </header>

    <!-- Main Navigation Tabs -->
    <nav class="bg-white border-b border-slate-200 flex-none">
        <div class="max-w-4xl mx-auto flex justify-around md:justify-center md:gap-8">
            <button class="nav-btn active border-b-4 border-blue-500 text-blue-600 py-4 px-2 md:px-6 font-bold flex flex-col md:flex-row items-center gap-2 transition-colors" onclick="switchTab('intro')">
                <i class="fa-solid fa-ruler-combined text-lg"></i>
                <span data-key="tab_intro">èªè­˜ç±³ (m)</span>
            </button>
            <button class="nav-btn border-b-4 border-transparent text-slate-400 hover:text-slate-600 py-4 px-2 md:px-6 font-bold flex flex-col md:flex-row items-center gap-2 transition-colors" onclick="switchTab('convert')">
                <i class="fa-solid fa-calculator text-lg"></i>
                <span data-key="tab_convert">æ›ç®—å·¥å…·</span>
            </button>
            <button class="nav-btn border-b-4 border-transparent text-slate-400 hover:text-slate-600 py-4 px-2 md:px-6 font-bold flex flex-col md:flex-row items-center gap-2 transition-colors" onclick="switchTab('quiz')">
                <i class="fa-solid fa-clipboard-question text-lg"></i>
                <span data-key="tab_quiz">å°æŒ‘æˆ°</span>
            </button>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="flex-grow overflow-y-auto overflow-x-hidden relative bg-slate-50 p-4 md:p-8">
        <div class="max-w-4xl mx-auto h-full relative">

            <!-- SECTION 1: INTRODUCTION (Recognizing Meter) -->
            <section id="intro" class="tab-content h-full flex flex-col animate-fade-in">
                <div class="bg-white rounded-2xl shadow-lg p-6 md:p-8 flex-grow flex flex-col justify-center items-center text-center">
                    
                    <h2 class="text-2xl font-bold text-blue-800 mb-2" data-key="intro_header">ä»€éº¼æ˜¯ 1 ç±³?</h2>
                    <p class="text-slate-500 mb-8 max-w-lg" data-key="intro_desc">ç±³ (m) æ˜¯ç”¨ä¾†é‡åº¦è¼ƒé•·ç‰©ä»¶çš„å–®ä½ã€‚è®“æˆ‘å€‘çœ‹çœ‹ 1 ç±³æœ‰å¤šé•·ï¼</p>

                    <!-- Visualization Container -->
                    <div class="w-full max-w-2xl bg-slate-100 rounded-xl p-6 md:p-10 border border-slate-200 mb-8 relative">
                        
                        <!-- The Ruler Visualization -->
                        <div class="relative h-24 w-full bg-slate-200 rounded-lg overflow-hidden border-2 border-slate-300 flex items-end shadow-inner">
                            <!-- Background Grid (represents cm) -->
                            <div class="absolute inset-0 opacity-20" style="background-image: linear-gradient(90deg, #94a3b8 1px, transparent 1px); background-size: 1% 100%;"></div>
                            
                            <!-- The Filling Tape -->
                            <div id="tapeMeasure" class="h-full bg-gradient-to-r from-yellow-400 to-orange-500 transition-all duration-300 ease-out flex items-center justify-end pr-2 text-white font-bold shadow-md" style="width: 0%;">
                                <span id="tapeValue" class="drop-shadow-md text-xl">0 cm</span>
                            </div>
                            
                            <!-- 1m Marker -->
                            <div class="absolute right-0 bottom-0 top-0 border-l-4 border-red-500 border-dashed opacity-50 flex items-start justify-center">
                                <span class="bg-red-500 text-white text-xs px-1 rounded mt-1">1 m</span>
                            </div>
                        </div>

                        <!-- Labels -->
                        <div class="flex justify-between mt-2 text-sm text-slate-400 font-mono">
                            <span>0 cm</span>
                            <span>50 cm</span>
                            <span>100 cm (1 m)</span>
                        </div>

                        <!-- Comparison Object -->
                        <div id="compareObject" class="mt-6 text-center transition-opacity duration-500 opacity-0">
                            <i class="fa-solid fa-child-reaching text-6xl text-blue-400"></i>
                            <p class="mt-2 text-blue-600 font-bold" data-key="intro_comparison">å°æœ‹å‹å¼µé–‹é›™è‡‚å¤§ç´„æ˜¯ 1 ç±³ï¼</p>
                        </div>
                    </div>

                    <!-- Controls -->
                    <div class="w-full max-w-md space-y-4">
                        <label class="block text-slate-600 font-bold mb-2" data-key="intro_drag">æ‹–å‹•æ»‘æ¡¿ä¾†æ¸¬é‡ï¼š</label>
                        <input type="range" min="0" max="100" value="0" class="w-full h-4 bg-slate-200 rounded-lg appearance-none cursor-pointer" id="introSlider">
                        <div class="text-3xl font-bold text-blue-600">
                            <span id="sliderValue">0</span> cm
                        </div>
                        <div id="equation" class="text-xl text-orange-600 font-bold bg-orange-50 px-4 py-2 rounded-lg inline-block border border-orange-200 opacity-0 transition-opacity">
                            1 m = 100 cm
                        </div>
                    </div>

                </div>
            </section>

            <!-- SECTION 2: CONVERSION (m <-> cm) -->
            <section id="convert" class="tab-content hidden h-full flex flex-col">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 h-full">
                    
                    <!-- Calculator Card -->
                    <div class="bg-white rounded-2xl shadow-lg p-6 flex flex-col justify-center">
                        <h2 class="text-xl font-bold text-blue-800 mb-6 flex items-center gap-2">
                            <i class="fa-solid fa-calculator text-blue-500"></i>
                            <span data-key="conv_title">æ›ç®—è¨ˆç®—æ©Ÿ</span>
                        </h2>

                        <!-- Mode Switch -->
                        <div class="flex bg-slate-100 p-1 rounded-lg mb-8">
                            <button class="flex-1 py-2 rounded-md text-sm font-bold transition-all bg-white text-blue-600 shadow-sm" id="modeMtoCm" onclick="setConversionMode('m_to_cm')">
                                m &rarr; cm
                            </button>
                            <button class="flex-1 py-2 rounded-md text-sm font-bold text-slate-500 transition-all hover:bg-white/50" id="modeCmtoM" onclick="setConversionMode('cm_to_m')">
                                cm &rarr; m
                            </button>
                        </div>

                        <!-- Input Area: m to cm -->
                        <div id="panelMtoCm" class="space-y-6">
                            <div class="flex items-end gap-2">
                                <div class="flex-1">
                                    <label class="block text-sm font-bold text-slate-500 mb-1" data-key="label_meter">ç±³ (m)</label>
                                    <input type="number" id="inputM" class="w-full text-3xl font-bold p-3 border-2 border-blue-200 rounded-xl text-center focus:border-blue-500 focus:outline-none text-blue-700" placeholder="1" value="1">
                                </div>
                                <div class="pb-4 text-2xl text-slate-400">=</div>
                                <div class="flex-1">
                                    <label class="block text-sm font-bold text-slate-500 mb-1" data-key="label_cm">å˜ç±³ (cm)</label>
                                    <div id="outputCm" class="w-full text-3xl font-bold p-3 bg-slate-100 rounded-xl text-center text-slate-600">100</div>
                                </div>
                            </div>
                            <div class="bg-blue-50 p-4 rounded-lg border border-blue-100 text-center">
                                <p class="text-blue-800 text-lg">
                                    <span id="explainM">1</span> m &times; 100 = <span id="explainResCm" class="font-bold">100</span> cm
                                </p>
                            </div>
                        </div>

                        <!-- Input Area: cm to m (Mixed) -->
                        <div id="panelCmtoM" class="hidden space-y-6">
                            <div>
                                <label class="block text-sm font-bold text-slate-500 mb-1" data-key="label_total_cm">ç¸½å˜ç±³ (cm)</label>
                                <input type="number" id="inputTotalCm" class="w-full text-3xl font-bold p-3 border-2 border-green-200 rounded-xl text-center focus:border-green-500 focus:outline-none text-green-700" placeholder="125" value="125">
                            </div>
                            
                            <div class="flex justify-center text-2xl text-slate-400 my-2"><i class="fa-solid fa-arrow-down"></i></div>

                            <div class="flex items-center gap-2">
                                <div class="flex-1 bg-green-50 p-3 rounded-xl border border-green-100 text-center">
                                    <div id="outputM" class="text-2xl font-bold text-green-700">1</div>
                                    <span class="text-xs text-green-600 font-bold">m</span>
                                </div>
                                <div class="text-xl text-slate-400">+</div>
                                <div class="flex-1 bg-green-50 p-3 rounded-xl border border-green-100 text-center">
                                    <div id="outputRemCm" class="text-2xl font-bold text-green-700">25</div>
                                    <span class="text-xs text-green-600 font-bold">cm</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Visual Explanation Card -->
                    <div class="bg-white rounded-2xl shadow-lg p-6 flex flex-col items-center justify-center bg-dots">
                        <h3 class="text-lg font-bold text-slate-600 mb-4" data-key="visual_guide">åœ–åƒæ‹†è§£</h3>
                        
                        <!-- Dynamic Visual Blocks -->
                        <div id="blockContainer" class="flex flex-wrap gap-2 justify-center content-start w-full h-64 overflow-y-auto no-scrollbar p-2">
                            <!-- Blocks will be injected here via JS -->
                        </div>

                        <p class="mt-4 text-sm text-slate-400 text-center" data-key="block_hint">1 å€‹è—è‰²é•·æ¢ = 100cm (1m)</p>
                    </div>
                </div>
            </section>

            <!-- SECTION 3: QUIZ (Unit Selection) -->
            <section id="quiz" class="tab-content hidden h-full flex flex-col">
                <div class="bg-white rounded-2xl shadow-lg h-full flex flex-col overflow-y-auto">
                    
                    <!-- Progress Bar -->
                    <div class="w-full bg-slate-100 h-2 flex-shrink-0">
                        <div id="progressBar" class="bg-green-500 h-2 transition-all duration-500" style="width: 0%"></div>
                    </div>

                    <!-- Quiz Content -->
                    <div class="flex-grow flex flex-col items-center justify-start md:justify-center p-6 text-center relative z-0 min-h-max">
                        
                        <!-- Question Counter -->
                        <div class="absolute top-4 right-6 bg-slate-100 px-3 py-1 rounded-full text-sm font-bold text-slate-500">
                            <span id="currentQ">1</span> / <span id="totalQ">5</span>
                        </div>

                        <!-- Question Image/Icon -->
                        <div class="w-48 h-48 bg-blue-50 rounded-full flex items-center justify-center mb-6 animate-bounce-small border-4 border-blue-100 mt-8 md:mt-0">
                            <i id="quizIcon" class="fa-solid fa-bus text-8xl text-blue-500"></i>
                        </div>

                        <!-- Question Text -->
                        <h2 class="text-2xl font-bold text-slate-700 mb-2" data-key="quiz_question">é¸æ“‡åˆé©çš„å–®ä½</h2>
                        
                        <!-- Dynamic Question Sentence -->
                        <div class="text-xl text-slate-600 mb-4 bg-slate-50 px-6 py-4 rounded-xl inline-block border border-slate-200">
                            <span id="questionTextContainer">
                                <!-- JS will inject text here -->
                            </span>
                        </div>

                        <p class="text-sm text-orange-500 font-bold mb-6 animate-pulse" data-key="quiz_instruction">è«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•ä½œç­”</p>

                        <!-- Options -->
                        <div class="grid grid-cols-2 gap-6 w-full max-w-md relative z-10 mb-8 md:mb-0">
                            <button onclick="checkAnswer('cm')" class="option-card bg-white border-2 border-slate-200 hover:border-orange-400 hover:bg-orange-50 rounded-xl p-6 flex flex-col items-center gap-2 group active:scale-95 active:bg-orange-100">
                                <span class="text-3xl font-bold text-slate-700 group-hover:text-orange-600">cm</span>
                                <span class="text-xs text-slate-400 font-bold" data-key="unit_cm">å˜ç±³</span>
                            </button>
                            <button onclick="checkAnswer('m')" class="option-card bg-white border-2 border-slate-200 hover:border-green-400 hover:bg-green-50 rounded-xl p-6 flex flex-col items-center gap-2 group active:scale-95 active:bg-green-100">
                                <span class="text-3xl font-bold text-slate-700 group-hover:text-green-600">m</span>
                                <span class="text-xs text-slate-400 font-bold" data-key="unit_m">ç±³</span>
                            </button>
                        </div>

                        <!-- Feedback Overlay -->
                        <div id="feedbackOverlay" class="absolute inset-0 bg-white/95 backdrop-blur-sm hidden flex-col items-center justify-center z-20 rounded-2xl">
                            <div id="feedbackIcon" class="text-6xl mb-4">ğŸ‰</div>
                            <h3 id="feedbackTitle" class="text-2xl font-bold mb-2">ç­”å°äº†ï¼</h3>
                            <p id="feedbackText" class="text-slate-500 mb-6 px-8 text-center max-w-lg">å·´å£«å¾ˆé•·ï¼Œè¦ç”¨ç±³(m)ä¾†é‡åº¦ã€‚</p>
                            <button onclick="nextQuestion()" class="hidden bg-blue-500 hover:bg-blue-600 text-white px-8 py-3 rounded-full font-bold shadow-lg transform transition hover:scale-105" data-key="btn_next" id="btnNext">
                                ä¸‹ä¸€é¡Œ &rarr;
                            </button>
                        </div>
                    </div>

                    <!-- End Screen -->
                    <div id="endScreen" class="hidden flex-col items-center justify-center h-full p-8 text-center bg-blue-50">
                        <i class="fa-solid fa-trophy text-6xl text-yellow-500 mb-4 animate-pulse"></i>
                        <h2 class="text-3xl font-bold text-blue-800 mb-2" data-key="quiz_finish">æŒ‘æˆ°å®Œæˆï¼</h2>
                        <p class="text-lg text-slate-600 mb-6"><span data-key="quiz_score">ä½ çš„å¾—åˆ†ï¼š</span> <span id="finalScore" class="font-bold text-blue-600 text-2xl">5/5</span></p>
                        <button onclick="restartQuiz()" class="bg-white border-2 border-blue-500 text-blue-600 hover:bg-blue-50 px-6 py-2 rounded-full font-bold transition" data-key="btn_restart">
                            å†ç©ä¸€æ¬¡
                        </button>
                    </div>

                </div>
            </section>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            init();
        });

        // --- DATA & CONFIG ---
        const translations = {
            zh: {
                title: "é•·åº¦ (äºŒ)",
                subtitle: "èªè­˜ç±³èˆ‡å˜ç±³æ›ç®—",
                tab_intro: "èªè­˜ç±³ (m)",
                tab_convert: "æ›ç®—å·¥å…·",
                tab_quiz: "å°æŒ‘æˆ°",
                intro_header: "ä»€éº¼æ˜¯ 1 ç±³?",
                intro_desc: "ç±³ (m) æ˜¯ç”¨ä¾†é‡åº¦è¼ƒé•·ç‰©ä»¶çš„å–®ä½ã€‚è®“æˆ‘å€‘çœ‹çœ‹ 1 ç±³æœ‰å¤šé•·ï¼",
                intro_comparison: "å°æœ‹å‹å¼µé–‹é›™è‡‚å¤§ç´„æ˜¯ 1 ç±³ï¼",
                intro_drag: "æ‹–å‹•æ»‘æ¡¿ä¾†æ¸¬é‡ï¼š",
                conv_title: "æ›ç®—è¨ˆç®—æ©Ÿ",
                label_meter: "ç±³ (m)",
                label_cm: "å˜ç±³ (cm)",
                label_total_cm: "ç¸½å˜ç±³ (cm)",
                visual_guide: "åœ–åƒæ‹†è§£",
                block_hint: "1 å€‹è—è‰²é•·æ¢ = 100cm (1m)",
                quiz_question: "é¸æ“‡åˆé©çš„å–®ä½",
                quiz_instruction: "è«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•ä½œç­”",
                quiz_item_prefix: "é€™",
                quiz_item_suffix: "çš„é•·åº¦/é«˜åº¦å¤§ç´„æ˜¯",
                unit_cm: "å˜ç±³",
                unit_m: "ç±³",
                btn_next: "ä¸‹ä¸€é¡Œ",
                btn_restart: "å†ç©ä¸€æ¬¡",
                quiz_finish: "æŒ‘æˆ°å®Œæˆï¼",
                quiz_score: "ä½ çš„å¾—åˆ†ï¼š",
                feedback_correct: "ç­”å°äº†ï¼",
                feedback_wrong: "å†æƒ³ä¸€æƒ³...",
                items: {
                    bus: "è¼›å·´å£«",
                    pencil: "æé‰›ç­†",
                    building: "åº§å¤§å»ˆ",
                    book: "æœ¬æ›¸",
                    tree: "æ£µæ¨¹"
                },
                explanations: {
                    bus: "å·´å£«å¾ˆé•·ï¼Œè¦ç”¨ç±³(m)ï¼",
                    pencil: "é‰›ç­†æ¯”è¼ƒçŸ­ï¼Œç”¨å˜ç±³(cm)æ¯”è¼ƒé©åˆã€‚",
                    building: "å¤§å»ˆå¾ˆé«˜ï¼Œç•¶ç„¶æ˜¯ç”¨ç±³(m)å•¦ã€‚",
                    book: "æ›¸æœ¬æ¯”è¼ƒçŸ­ï¼Œç”¨å˜ç±³(cm)ã€‚",
                    tree: "é€™æ£µå¤§æ¨¹å¾ˆé«˜ï¼Œè¦ç”¨ç±³(m)ã€‚"
                }
            },
            en: {
                title: "Length (II)",
                subtitle: "Meters and Centimeters",
                tab_intro: "Meet Meter (m)",
                tab_convert: "Converter",
                tab_quiz: "Quiz",
                intro_header: "What is 1 Meter?",
                intro_desc: "Meter (m) is used for longer objects. Let's see how long 1 meter is!",
                intro_comparison: "A child's arm span is about 1 meter!",
                intro_drag: "Drag slider to measure:",
                conv_title: "Length Converter",
                label_meter: "Meter (m)",
                label_cm: "Centimeter (cm)",
                label_total_cm: "Total (cm)",
                visual_guide: "Visual Breakdown",
                block_hint: "1 Blue Bar = 100cm (1m)",
                quiz_question: "Choose the Unit",
                quiz_instruction: "Tap the buttons below",
                quiz_item_prefix: "The length/height of this",
                quiz_item_suffix: "is about",
                unit_cm: "Centimeter",
                unit_m: "Meter",
                btn_next: "Next",
                btn_restart: "Play Again",
                quiz_finish: "Great Job!",
                quiz_score: "Your Score:",
                feedback_correct: "Correct!",
                feedback_wrong: "Try again...",
                items: {
                    bus: " Bus",
                    pencil: " Pencil",
                    building: " Building",
                    book: " Book",
                    tree: " Tree"
                },
                explanations: {
                    bus: "A bus is long, so we use meters (m).",
                    pencil: "A pencil is short, so we use centimeters (cm).",
                    building: "Buildings are tall, use meters (m).",
                    book: "A book is small, use centimeters (cm).",
                    tree: "A big tree is tall, use meters (m)."
                }
            }
        };

        const quizData = [
            { id: 'bus', icon: 'fa-bus', val: 12, correct: 'm' },
            { id: 'pencil', icon: 'fa-pen', val: 15, correct: 'cm' },
            { id: 'building', icon: 'fa-building', val: 50, correct: 'm' },
            { id: 'book', icon: 'fa-book', val: 25, correct: 'cm' },
            { id: 'tree', icon: 'fa-tree', val: 5, correct: 'm' }
        ];

        let currentLang = 'zh';
        let currentQuizIndex = 0;
        let score = 0;

        // --- CORE FUNCTIONS ---

        function init() {
            updateLanguageUI();
            
            // Intro Slider Logic
            const slider = document.getElementById('introSlider');
            if(slider) {
                slider.addEventListener('input', (e) => {
                    const val = e.target.value;
                    document.getElementById('sliderValue').innerText = val;
                    document.getElementById('tapeValue').innerText = val + " cm";
                    document.getElementById('tapeMeasure').style.width = val + "%";
                    
                    // Visual cues
                    const object = document.getElementById('compareObject');
                    const eq = document.getElementById('equation');
                    
                    if(val == 100) {
                        document.getElementById('tapeMeasure').classList.remove('from-yellow-400', 'to-orange-500');
                        document.getElementById('tapeMeasure').classList.add('from-green-400', 'to-green-600');
                        document.getElementById('tapeValue').innerText = "1 m (100 cm)";
                        object.style.opacity = '1';
                        eq.style.opacity = '1';
                    } else {
                        document.getElementById('tapeMeasure').classList.add('from-yellow-400', 'to-orange-500');
                        document.getElementById('tapeMeasure').classList.remove('from-green-400', 'to-green-600');
                        object.style.opacity = '0.1';
                        eq.style.opacity = '0';
                    }
                });
            }

            // Converter Logic
            if(document.getElementById('inputM')) document.getElementById('inputM').addEventListener('input', calculateMtoCm);
            if(document.getElementById('inputTotalCm')) document.getElementById('inputTotalCm').addEventListener('input', calculateCmtoM);
            
            // Initial renders
            renderBlocks(1, 0); 
            loadQuestion();
        }

        // Language Switcher
        document.getElementById('langToggle').addEventListener('click', () => {
            currentLang = currentLang === 'zh' ? 'en' : 'zh';
            document.getElementById('langText').innerText = currentLang === 'zh' ? 'English' : 'ä¸­æ–‡';
            updateLanguageUI();
            loadQuestion(); // Refresh quiz text
        });

        function updateLanguageUI() {
            document.documentElement.lang = currentLang === 'zh' ? 'zh-HK' : 'en';
            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.getAttribute('data-key');
                if (translations[currentLang][key]) {
                    el.innerText = translations[currentLang][key];
                }
            });
        }

        // Tab Switching
        window.switchTab = (tabId) => {
            // Update buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active', 'border-blue-500', 'text-blue-600');
                btn.classList.add('border-transparent', 'text-slate-400');
            });
            event.currentTarget.classList.add('active', 'border-blue-500', 'text-blue-600');
            event.currentTarget.classList.remove('border-transparent', 'text-slate-400');

            // Show Content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(tabId).classList.remove('hidden');
        };

        // --- CONVERTER LOGIC ---

        function setConversionMode(mode) {
            const btnM = document.getElementById('modeMtoCm');
            const btnCm = document.getElementById('modeCmtoM');
            const panelM = document.getElementById('panelMtoCm');
            const panelCm = document.getElementById('panelCmtoM');

            if (mode === 'm_to_cm') {
                btnM.classList.replace('text-slate-500', 'text-blue-600');
                btnM.classList.add('bg-white', 'shadow-sm');
                btnCm.classList.replace('text-blue-600', 'text-slate-500');
                btnCm.classList.remove('bg-white', 'shadow-sm');
                panelM.classList.remove('hidden');
                panelCm.classList.add('hidden');
                calculateMtoCm();
            } else {
                btnCm.classList.replace('text-slate-500', 'text-blue-600');
                btnCm.classList.add('bg-white', 'shadow-sm');
                btnM.classList.replace('text-blue-600', 'text-slate-500');
                btnM.classList.remove('bg-white', 'shadow-sm');
                panelCm.classList.remove('hidden');
                panelM.classList.add('hidden');
                calculateCmtoM();
            }
        }

        function calculateMtoCm() {
            let m = parseInt(document.getElementById('inputM').value) || 0;
            if (m < 0) m = 0;
            if (m > 10) m = 10; // Cap for visual simplicity
            const cm = m * 100;
            
            document.getElementById('outputCm').innerText = cm;
            document.getElementById('explainM').innerText = m;
            document.getElementById('explainResCm').innerText = cm;
            renderBlocks(m, 0);
        }

        function calculateCmtoM() {
            let totalCm = parseInt(document.getElementById('inputTotalCm').value) || 0;
            if (totalCm < 0) totalCm = 0;
            if (totalCm > 1099) totalCm = 1099; // Cap

            const m = Math.floor(totalCm / 100);
            const remCm = totalCm % 100;

            document.getElementById('outputM').innerText = m;
            document.getElementById('outputRemCm').innerText = remCm;
            renderBlocks(m, remCm);
        }

        function renderBlocks(m, cm) {
            const container = document.getElementById('blockContainer');
            if(!container) return;
            container.innerHTML = '';

            // Draw 1m Blocks (Blue)
            for (let i = 0; i < m; i++) {
                const block = document.createElement('div');
                block.className = 'w-full h-8 bg-blue-500 rounded flex items-center justify-center text-white font-bold text-xs mb-1 shadow-sm animate-fade-in';
                block.innerText = '1m (100cm)';
                block.style.width = '100%'; // Full width represents 100cm visually in this context
                container.appendChild(block);
            }

            // Draw remaining cm (Green)
            if (cm > 0) {
                const block = document.createElement('div');
                // Calculate percentage width roughly (min 10% for visibility)
                const width = Math.max(15, cm); 
                block.className = 'h-8 bg-green-500 rounded flex items-center justify-center text-white font-bold text-xs mb-1 shadow-sm animate-fade-in';
                block.innerText = cm + 'cm';
                block.style.width = width + '%';
                container.appendChild(block);
            }
        }

        // --- QUIZ LOGIC ---

        function loadQuestion() {
            if (currentQuizIndex >= quizData.length) return;

            const q = quizData[currentQuizIndex];
            const t = translations[currentLang];

            // Reset UI
            const overlay = document.getElementById('feedbackOverlay');
            overlay.classList.remove('flex');
            overlay.classList.add('hidden');
            
            // Crucial: Reset Next Button visibility (Hidden by default until answered correctly)
            const nextBtn = document.getElementById('btnNext');
            nextBtn.classList.add('hidden');

            // Set content
            document.getElementById('currentQ').innerText = currentQuizIndex + 1;
            document.getElementById('totalQ').innerText = quizData.length;
            document.getElementById('quizIcon').className = `fa-solid ${q.icon} text-8xl text-blue-500`;
            
            const itemName = t.items[q.id];
            
            // Build the sentence dynamically
            const container = document.getElementById('questionTextContainer');
            // Using a visual placeholder [ ? ] for the blank to prevent user trying to type
            container.innerHTML = `
                ${t.quiz_item_prefix} 
                <span class="font-bold text-blue-600">${itemName}</span> 
                ${t.quiz_item_suffix} 
                <span class="font-mono bg-yellow-100 text-yellow-700 px-2 py-1 rounded mx-1">${q.val}</span>
                <span class="inline-block bg-slate-200 text-slate-500 px-2 py-1 rounded font-bold border-b-4 border-slate-300 animate-pulse">?</span>
            `;
        }

        window.checkAnswer = (answer) => {
            const q = quizData[currentQuizIndex];
            const t = translations[currentLang];
            const overlay = document.getElementById('feedbackOverlay');
            const icon = document.getElementById('feedbackIcon');
            const title = document.getElementById('feedbackTitle');
            const text = document.getElementById('feedbackText');
            const nextBtn = document.getElementById('btnNext');

            overlay.classList.remove('hidden');
            overlay.classList.add('flex');

            if (answer === q.correct) {
                score++;
                icon.innerText = "ğŸ‰";
                title.innerText = t.feedback_correct;
                title.className = "text-2xl font-bold mb-2 text-green-600";
                text.innerText = t.explanations[q.id];
                nextBtn.classList.remove('hidden'); // Show Next button only on correct
                updateProgress();
            } else {
                icon.innerText = "ğŸ¤”";
                title.innerText = t.feedback_wrong;
                title.className = "text-2xl font-bold mb-2 text-orange-600";
                text.innerText = "";
                nextBtn.classList.add('hidden'); // Ensure next button is hidden on wrong answer
                
                // Hide overlay after delay so user can try again
                setTimeout(() => {
                    overlay.classList.add('hidden');
                    overlay.classList.remove('flex');
                }, 1200);
            }
        };

        window.nextQuestion = () => {
            currentQuizIndex++;
            if (currentQuizIndex < quizData.length) {
                loadQuestion();
            } else {
                showEndScreen();
            }
        };

        function updateProgress() {
            const pct = ((currentQuizIndex + 1) / quizData.length) * 100;
            document.getElementById('progressBar').style.width = pct + "%";
        }

        function showEndScreen() {
            document.querySelector('#quiz > div > div.flex-grow').classList.add('hidden');
            document.getElementById('endScreen').classList.remove('hidden');
            document.getElementById('endScreen').classList.add('flex');
            document.getElementById('finalScore').innerText = `${score} / ${quizData.length}`;
        }

        window.restartQuiz = () => {
            currentQuizIndex = 0;
            score = 0;
            document.getElementById('progressBar').style.width = "0%";
            document.getElementById('endScreen').classList.add('hidden');
            document.getElementById('endScreen').classList.remove('flex');
            document.querySelector('#quiz > div > div.flex-grow').classList.remove('hidden');
            loadQuestion();
        };

    </script>

    <style>
        .bg-dots {
            background-image: radial-gradient(#e2e8f0 2px, transparent 2px);
            background-size: 20px 20px;
        }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
        @keyframes bounce-small {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .animate-bounce-small {
            animation: bounce-small 2s infinite;
        }
    </style>
</body>
</html>
